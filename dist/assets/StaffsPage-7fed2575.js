import{v as Q,r as c,c as T,l as W,a as G,o as m,b as x,f as r,w as d,d as a,u as w,t as y,g as C,y as H,A as z,F as q,e as J,m as X,h as Y,i as E,q as Z}from"./index-c34ed4f6.js";import{A as U}from"./app-modal-afe5a922.js";import{_ as M,s as I,d as O}from"./VButton-ff6e3586.js";import{_ as F}from"./VInput-5d59eade.js";import{a as _}from"./apiClient-172dff35.js";import{S as ee,j as te}from"./mdi-b3f72374.js";import{L as le}from"./Loader-93f7da13.js";import{_ as ae,a as se}from"./VAction-899cce77.js";const D={getStaffs(e){const t=`director/get-staffs/q?page=${e==null?void 0:e.page}&limit=${e==null?void 0:e.limit}`;return _.get(t)},getTeachers(e){const t=`teachers/all/q?page=${e==null?void 0:e.page}&limit=${e==null?void 0:e.limit}`;return _.get(t)},activateStaff(e){const t=`director/activate-staff/${e}`;return _.post(t)},getTeacherById(e){const t=`teachers/${e}`;return _.get(t)},addStaff(e){const t="director/add-staff";return _.post(t,e)},deleteStaff(e){const t=`director/delete-staff/${e}`;return _.delete(t)},addTeacher(e){const t="teachers/add-teacher";return _.post(t,e)},updateTeacher(e,t){const l=`teachers/update/${t}`;return _.put(l,e)},deleteTeacher(e){const t=`teachers/delete/${e}`;return _.delete(t)},getRoles(){const e="roles/all";return _.get(e)}},K=Q("director-staff",{state:()=>({staffs:null,loading:!1,error:null,status:null,staff:null,loadingRoles:!1}),actions:{async addStaff(e){var t;try{const l=await D.addStaff(e);return this.staff=l.staff,console.log(l),!0}catch(l){return this.error=(t=l==null?void 0:l.response)==null?void 0:t.data,console.log(l),!1}finally{}},async getStaffs(e){var t;try{this.loading=!0;const l=await D.getStaffs(e);return this.staffs=l.staffs,console.log(l),l}catch(l){return this.error=(t=l==null?void 0:l.response)==null?void 0:t.data,console.log(l),!1}finally{this.loading=!1}},async getRoles(){var e;try{this.loadingRoles=!0;const t=await D.getRoles();return console.log(t),t!=null&&t.roles?t.roles:[]}catch(t){return this.error=(e=t==null?void 0:t.response)==null?void 0:e.data,console.log(t),!1}finally{this.loadingRoles=!1}},async deleteStaff(e){var t;try{const l=await D.deleteStaff(e);return console.log(l),!0}catch(l){return this.error=(t=l==null?void 0:l.response)==null?void 0:t.data,console.log(l),!1}finally{}}}}),oe={class:"w-full flex justify-center items-center"},ne={class:"text-[24px] font-bold w-full text-center mb-[20px] text-color1"},re={class:"flex justify-center items-center w-full gap-3"},ie={class:"text-[24px] font-bold w-full text-center mb-[20px] text-color1"},ce={class:"flex justify-between items-center gap-3 mb-2"},ue=a("label",{for:"role",class:"text-[19px] text-color1 font-medium mb-1 inline-block"},"Select Role ",-1),de=a("option",{value:"",hidden:"",selected:""},"Select role",-1),fe=["value"],me={__name:"StaffModal",props:{roles:[]},setup(e,{expose:t}){const l=K(),v=c(!1),p=c(!1);c();const u=c(!1),$=c("Add New Staff"),V=c(""),N=c("Are you sure to delete?"),b=T(()=>l.loading?"Loading":"Save"),f=c({first_name:"",last_name:"",phone:"",role:""});W(p,n=>{n||(f.value={first_name:"",last_name:"",phone:"",role:""},$.value="Add New Staff")});const S=async n=>{n._id&&(f.value={...n},$.value="Edit Staff",console.log(f.value,"forms")),p.value=!0,u.value=!1},j=n=>{V.value=n,v.value=!0},A=()=>{v.value=!1},h=()=>{p.value=!1},g=T(()=>({last_name:"required|min:3|max:30",first_name:"required|min:3|max:30",phone:"required|phone:19"})),B=async n=>{var i;u.value=!0,console.log(f.value),(i=f.value)!=null&&i._id||(await l.addStaff({...n,phone:n.phone.split("").filter(s=>s==="+"||!isNaN(+s)).join(""),role:f.value.role})?(I("successfully added "),p.value=!1,location.reload()):O(l.error)),u.value=!1},R=async()=>{u.value=!0,await l.deleteStaff(V.value)?I("Deleted success"):O("Failed!"),v.value=!1,u.value=!1,location.reload()};return t({openModal:S,closeModal:h,openDelModal:j}),(n,i)=>{const k=G("vee-form");return m(),x(q,null,[r(U,{modelValue:v.value,"onUpdate:modelValue":i[0]||(i[0]=s=>v.value=s)},{default:d(()=>[r(k,null,{default:d(()=>[a("span",oe,[r(w(ee),{type:"mdi",path:w(te),class:"w-20 h-20 text-red-700 mb-3"},null,8,["path"])]),a("h1",ne,y(N.value),1),a("div",re,[r(M,{btn_type:"danger",isLoading:u.value,type:"button",class:"mt-5 text-[18px] px-8",onClick:R},{default:d(()=>[C(" Delete ")]),_:1},8,["isLoading"]),r(M,{btn_type:"primary",isLoading:!1,type:"button",class:"mt-5 px-8 text-[18px]",onClick:A},{default:d(()=>[C(" Cancel ")]),_:1})])]),_:1})]),_:1},8,["modelValue"]),r(U,{modelValue:p.value,"onUpdate:modelValue":i[3]||(i[3]=s=>p.value=s)},{default:d(()=>[a("h1",ie,y($.value),1),a("div",ce,[ue,H(a("select",{id:"role","onUpdate:modelValue":i[1]||(i[1]=s=>f.value.role=s),onChange:i[2]||(i[2]=(...s)=>n.handleRolePicker&&n.handleRolePicker(...s)),class:"outline-none border px-2 rounded-md py-2 text-sm"},[de,(m(!0),x(q,null,J(e.roles,(s,L)=>(m(),x("option",{key:L,value:s==null?void 0:s._id},y(s==null?void 0:s.name),9,fe))),128))],544),[[z,f.value.role]])]),r(k,{"validation-schema":g.value,"initial-values":f.value,onSubmit:B},{default:d(()=>[r(F,{type:"text",name:"first_name",label:"First Name",placeholder:"Enter your name"}),r(F,{type:"text",name:"last_name",label:"Last Name",placeholder:"Enter your surname"}),r(F,{type:"text",name:"phone",label:"Phone",placeholder:"(+998)-90-123-45-67",mask:"(+998)-##-###-##-##"}),r(M,{btn_type:"primary",isLoading:u.value,type:"submit",class:"mt-5 w-full text-[18px]"},{default:d(()=>[C(y(b.value),1)]),_:1},8,["isLoading"])]),_:1},8,["validation-schema","initial-values"])]),_:1},8,["modelValue"])],64)}}},pe={class:"w-full pt-5"},_e={class:"w-full"},ve={key:1},he={class:"w-full flex justify-between items-center pr-5"},ge={class:"text-[#002842] text-[22px] font-semibold uppercase"},xe={class:"mt-3 flex justify-start items-center gap-5"},ye=a("span",{class:"text-color1 text-[18px] font-medium"},"Filters",-1),be=a("option",{value:"",selected:"",hidden:""},"by role",-1),we=["value"],Se={class:"w-full mt-2"},ke=a("span",{class:"w-full flex justify-center items-center"},[a("input",{type:"checkbox",class:"w-[18px] h-[18px]"})],-1),$e=["onClick"],Ce={class:"w-full flex justify-start items-center"},Ve={key:1,class:"w-full text-center text-[20px] text-color1 mt-10 font-medium"},Re={key:2,class:"w-full flex justify-end px-5 items-center mt-3"},qe={__name:"StaffsPage",setup(e){const t=X(),l=K(),v=c(""),p=c([]),u=c({role:"",status:null}),$=()=>{console.log(u.value)},V=()=>{u.value={role:"",status:null},console.log(u.value)},N=async()=>{S.value=await l.getStaffs(b.value)},b=c({page:1,limit:10}),f=c([{title:"checkbox",value:"check"},{title:"ID",value:"_id"},{title:"Full name",value:"full_name"},{title:"Phone number",value:"phone"},{title:"Role",value:"role"},{title:"Started",value:"start_date"},{title:"Status",value:"status"},{title:"Action",value:"action"}]),S=c(0);Y(async()=>{var g;const h=await Promise.all([l.getStaffs(b.value),l.getRoles()]);S.value=(g=h[0])==null?void 0:g.count,p.value=h[1]});const j=h=>{t.push({name:"director_single_staffs",params:{id:h}})},A=h=>new Date(h).toLocaleDateString("en-GB");return(h,g)=>{var R,n,i,k,s,L;const B=G("vue-awesome-paginate");return m(),x("div",pe,[a("div",_e,[r(me,{ref_key:"staff_modal",ref:v,roles:p.value},null,8,["roles"])]),w(l).loading?(m(),E(le,{key:0})):(m(),x("div",ve,[a("div",he,[a("h1",ge," Staffs ("+y(S.value)+") ",1),r(M,{type:"button",btn_type:"primary",isLoading:(R=w(l))==null?void 0:R.loadingRoles,onClick:v.value.openModal,class:"px-10"},{default:d(()=>[C("Add Staff")]),_:1},8,["isLoading","onClick"])]),a("div",xe,[ye,H(a("select",{onChange:$,"onUpdate:modelValue":g[0]||(g[0]=o=>u.value.role=o),class:"text-[#002842] text-[16px] font-medium bg-transparent outline-none"},[be,(m(!0),x(q,null,J(p.value,(o,P)=>(m(),x("option",{key:P,value:o==null?void 0:o._id,class:""},y(o==null?void 0:o.name),9,we))),128))],544),[[z,u.value.role]]),a("button",{onClick:V,class:"border-none bg-[#002842] px-3 py-1 text-white text-lg rounded-lg hover:bg-[#002892] active:bg-[#002832]",type:"button"}," clear filters ")]),a("div",Se,[(i=(n=w(l))==null?void 0:n.staffs)!=null&&i.length?(m(),E(ae,{key:0,header:f.value,data:(k=w(l))==null?void 0:k.staffs},{body_check:d(()=>[ke]),body_full_name:d(({item:o})=>[a("span",{onClick:P=>j(o._id),class:"w-full"},y(`${o.first_name} ${o.last_name}`),9,$e)]),body_start_date:d(({item:o})=>[C(y(A(o==null?void 0:o.start_date)),1)]),body_action:d(({item:o})=>[a("span",Ce,[r(se,{item:o,item_action:v.value},null,8,["item","item_action"])])]),_:1},8,["header","data"])):(m(),x("h1",Ve," No data ")),(L=(s=w(l))==null?void 0:s.staffs)!=null&&L.length?(m(),x("div",Re,[r(B,{"total-items":S.value,"items-per-page":b.value.limit,"max-pages-shown":2,modelValue:b.value.page,"onUpdate:modelValue":g[1]||(g[1]=o=>b.value.page=o),"on-click":N},null,8,["total-items","items-per-page","modelValue"])])):Z("",!0)])]))])}}};export{qe as default};
